---

# -----------------------------------------------------------------------------
# File        : ctlabs/lab01/lab01.yml
# Description : BGP Lab ctlabs configuration
# -----------------------------------------------------------------------------

name: lab01
desc: BGP Lab

defaults:
  switch:
    linux:
      image: ctlabs/c8/base:0.3
  host:
    linux:
      image: ctlabs/c8/base:0.3
    kali:
      image: ctlabs/misc/kali:0.1
    qemu:
      image: ctlabs/c8/qemu:0.1
    zap:
      image: ctlabs/misc/zap:0.1
  router:
    frr:
      image: ctlabs/c8/frr:0.3
      caps : [SYS_NICE]

topology:
  - vm:
    name: lab01-vm1
    nodes:
      mgmt:
        type  : switch
        ipv4  : 192.168.40.1/24
        ports : 8
      ansible :
        type : host
        gw   : 192.168.15.1
        nics :
          eth0: 192.168.40.3/24
          eth1: 192.168.15.3/29
        vols : ['/tmp/ansible/:/root/ansible/:ro']
      natgw:
        type : gateway
        ipv4 : 192.168.15.1/29
        snat : true
        dnat : ro1:eth3
      sw1:
        type : switch
        ipv4 : 192.168.10.6/24
        gw   : 192.168.10.1
        vxlan:
          id     : 10
          local  : 192.168.100.194:4789
          remote : 192.168.100.193:4789
        nics:
          eth0: 192.168.40.5/24
      sw2:
        type: switch
        nics:
          eth0: 192.168.40.6/24
      ro1:
        type : router
        kind : frr
        gw   : 192.168.15.1
        vols : ["$PWD/../vpn/:/root/vpn/:ro"]
        nics :
          eth0: 192.168.40.11/24
          eth1: 192.168.12.1/30
          eth2: 192.168.10.1/24
          eth3: 192.168.15.2/29
      ro2:
        type : router
        kind : frr
        nics :
          eth0: 192.168.40.12/24
          eth1: 192.168.12.2/30
        bonds:
          bond0:
            mode: 802.3ad
            nics: [eth2, eth3]
            vlan:
              20: 192.168.20.1/24
      h1:
        type : host
        kind : kali
        gw   : 192.168.10.1
        nics :
          eth0: 192.168.40.21/24
          eth1: 192.168.10.11/24
        dnat :
          - [1337, 1337, 'udp']
          - [3000, 3000]
#      h2:
#        type  : host
#        kind  : qemu
#        kvm   : true
#        vols  : ['/root/imgs:/root/imgs:ro']
#        gw    : 192.168.20.1
#        nics  :
#          eth0: 
#            master: vnet0
#          eth1: 
#            ipv4: 192.168.20.31/24
#            dnat:
#              tcp:
#                - [5901, 5901]
#              udp:
#                - [1337, 1337]
#          vnet0:
#            type: bridge
#            ipv4: 192.168.20.31/24
#            dnat:
#              tcp:
#                - [5901, 5901]
#          eth2:
#            master: bond0
#          eth3:
#            master: bond0
#          bond0:
#            type: bond
#            mode: active-backup
#            #nics: [eth3, eth4]
#            vlan:
#              20: 192.168.20.12/24
      h2:
        type  : host
        kind  : qemu
        kvm   : true
        vols  : ['/root/imgs:/root/imgs:ro']
        gw    : 192.168.20.1
        nics  :
          eth0: 192.168.40.23/24
          eth1: 192.168.20.13/24
        dnat  :
          - [5901, 5901]
      zap:
        type  : host
        kind  : zap
      #  cmd   : zap-webswing.sh
        gw    : 192.168.10.1
        vols  : ['/tmp/zap/:/zap/wrk/:rw']
        nics  :
          eth0: 192.168.40.24/24
          eth1: 192.168.10.14/24
        dnat  :
          - [8080, 8080]
          - [8090, 8090]

    links:
      - [ "ro1:eth1", "ro2:eth1" ]

      - [ "ro1:eth2", "sw1:eth1"  ]
      - [ "ro1:eth3", "natgw:eth0"  ]

      - [ "ro2:eth2", "sw2:eth1"  ]
      - [ "ro2:eth3", "sw2:eth2"  ]

      - [ "sw1:eth3", "h1:eth1"   ]
      - [ "sw1:eth4", "zap:eth1"   ]

      #- [ "sw1:eth2", "h2:eth1"   ]
      - [ "sw2:eth3", "h2:eth1"   ]

      - [ "ansible:eth1", "natgw:eth1" ]

      - [ "mgmt:eth0", "sw1:eth0" ]
      - [ "mgmt:eth1", "sw2:eth0" ]
      - [ "mgmt:eth2", "ro1:eth0" ]
      - [ "mgmt:eth3", "ro2:eth0" ]
      - [ "mgmt:eth4", "h1:eth0"  ]
      - [ "mgmt:eth5", "h2:eth0"  ]
      - [ "mgmt:eth6", "zap:eth0"  ]
      - [ "mgmt:eth7", "ansible:eth0"  ]
